<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8"> <!-- 設定編碼為 UTF-8 -->
    <title>登入 STR 系統</title> <!-- 網頁標題 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='login.css') }}">
</head>

<body>
    <!-- ✅ 外層容器：垂直置中用 -->
    <div class="container">
        <div class="login-box"> <!-- 登入框主體 -->
            <h1>草圖轉真實圖 - 登入系統</h1> <!-- 標題文字 -->

            <input type="text" id="username" placeholder="帳號"> <!-- 輸入帳號 -->
            <input type="password" id="password" placeholder="密碼"> <!-- 輸入密碼 -->

            <div class="login-btns"> <!-- 登入 / 註冊 按鈕列 -->
                <button onclick="login()">登入</button> <!-- 登入按鈕 -->
                <button onclick="window.location.href='register.html'">註冊</button> <!-- 跳轉註冊頁 -->
            </div>

            <button id="forgot-btn" onclick="goToForget()" style="display: none; margin-top: 10px;">
                忘記密碼？ <!-- 忘記密碼按鈕（預設隱藏） -->
            </button>
        </div>
    </div>

    <!-- ✅ 頁尾區塊 -->
    <footer>
        hong 版權所有 <!-- 版權宣告 -->
    </footer>

    <!-- ✅ JavaScript 功能區 -->
    <script>
        // 登入功能
        function login() {
            const username = document.getElementById("username").value.trim();  // 取得帳號
            const password = document.getElementById("password").value.trim();  // 取得密碼

            if (!username || !password) {                                       // 檢查是否為空
                alert("帳號與密碼不可為空白！");
                return;
            }

            // 發送登入請求
            fetch("/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password })
            })
                .then(async res => {
                    // ✅ 先檢查狀態碼 & 確保 response 內容不是空的
                    const text = await res.text();
                    try {
                        const json = JSON.parse(text);
                        if (!res.ok) throw new Error(json.msg || "登入失敗");
                        return json;
                    } catch (e) {
                        throw new Error("無效的 JSON 回應，可能是後端掛掉或沒回傳資料");
                    }
                })
                .then(data => {
                    localStorage.setItem("username", username);
                    localStorage.setItem("name", data.name);
                    window.location.href = "index.html";
                })
                .catch(err => {
                    alert("⚠️ 登入失敗：" + err.message);
                });
        }

        // 忘記密碼頁跳轉
        function goToForget() {
            window.location.href = "forget.html";
        }
    </script>
</body>

</html>